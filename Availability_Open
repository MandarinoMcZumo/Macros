Private Sub Workbook_Open()

On Error Resume Next

Dim ceros As Range, formato_incorrecto As Integer, columna as integer, fila as integer, dias as integer
Dim xSh As Worksheet
        

Application.ScreenUpdating = False
Application.DisplayAlerts = False

'Bucle para comprobar si el libro ya ha sido modificado

For Each xSh In Worksheets

If xSh.Name = "Colores Condicionales" Then

formato_incorrecto = 1

End If

Next xSh


'Bucle para dar formato

If formato_incorrecto = 1 Then
        
For Each xSh In Worksheets

xSh.Select
        
        Cells.FormatConditions.Delete
        
        Cells.Font.Name = "Tahoma"
        Cells.Font.Size = 8
        
        Rows.RowHeight = 18
        Columns.ColumnWidth = 8.67
        Range("A1").ColumnWidth = 11.78
        
        'Resumen KPI's
        
        With Range("A2:A10")
        
        .Interior.Color = RGB(245, 245, 245)
        .HorizontalAlignment = xlLeft
        .WrapText = True
        
        End With
        
        With Range("A1:B1")
        
        .Interior.Color = RGB(245, 245, 245)
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .Font.Bold = True
        
        End With
        
        
        
        'Detalle por días
        
        
        
        'Columna con nombre KPI's
        
        With Range("A13:A36")
        
        .Interior.Color = RGB(245, 245, 245)
        .HorizontalAlignment = xlLeft
        .WrapText = True
        
        End With
        
        'Fecha
        
        With Range("A13:DQ13")
        
        .Interior.Color = RGB(245, 245, 245)
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .Font.Bold = True
        .WrapText = True
        .RowHeight = 22
        
        End With
        
        'Commercial Available
        
        With Range("B24:DQ24")
        
        .Interior.Color = RGB(226, 239, 218)
        
        End With
        
        'On Rent
        
        With Range("B27:DQ27")
        
        .Interior.Color = RGB(226, 239, 218)
        
        End With
        
        '% Occupation
        
        With Range("B31:DQ31")
        
        .Interior.Color = RGB(226, 239, 218)
        .NumberFormat = "0%"
        
        
        End With
        
        '% Occupation LY
        
        With Range("B32:DQ32")
        
        .NumberFormat = "0%"
        
        End With
        
        
        
        'Operating Fleet
        
        With Range("B33:DQ33")
        
        .Interior.Color = RGB(226, 239, 218)
        
        End With
        
        '% Commercial Utilization
        
        With Range("B35:DQ35")
        
        .Interior.Color = RGB(226, 239, 218)
        .NumberFormat = "0%"
        
        End With
        
        '% Commercial Utilization LY
        
        With Range("B36:DQ36")
        
        .NumberFormat = "0%"
        
        End With
        
        
        'Matriz de Valores
        
        With Range("B14:DQ36")
        
        .VerticalAlignment = xlCenter
        
        End With
        
        
        
        'Aplica negritas
        
        For Each ceros In Range("B14:DQ20")
        
        If ceros.Offset(38, 0).Value = 2 Or ceros.Offset(38, 0).Value = 3 Then
        
        ceros.Font.Bold = True
        
        End If
        
        Next ceros
        
        'Resalta 0 y negativos
        
        For Each ceros In Range("B24:DQ24")
        
        If ceros.Value <= 0 Then
        
        ceros.Font.Bold = True
        ceros.Font.Color = vbRed
        
        End If
        
        Next ceros
        
        'Color sábados
        
        
        
         For Each ceros In Range("A13:DQ13")
         
         If ceros.Value Like "Sat" & "*" Then
         
         Range(ceros.Offset(1, 0), ceros.Offset(23, 0)).Interior.Color = RGB(226, 239, 218)
         
         End If
         
         Next ceros
         
         
        'Elimina datos Qliksense
        
        Range("A51:DQ74").Delete

Next xSh


        

'Selecciona la hoja del país
        
For Each xSh In Worksheets
    
        If xSh.Name = "CROATIA" Or xSh.Name = "SPAIN" Or xSh.Name = "FRANCE" Or xSh.Name = "TURKEY" Or xSh.Name = "GREECE" Or xSh.Name = "UNITED KINGDOM" Or xSh.Name = "ITALY" Or xSh.Name = "PORTUGAL" Then
        
            xSh.Select
			
        
        End If
    
Next xSh


'Aplicación de negritas en la hoja país

dias = 0

        For Each ceros In Range("B20:DQ20")
        
        ' Debug.Print "Valor pick ups " & ceros
        ' Debug.Print "Valor control " & Sheets("Colores Condicionales").Cells(2 + dias, 7).Value
        ' Debug.Print "Nº dia " & dias
               
        If Sheets("Colores Condicionales").Cells(7, 2 + dias) = 2 Or Sheets("Colores Condicionales").Cells(7, 2 + dias) = 3 Then
        
        ceros.Font.Bold = True
        
        End If
        
        dias = dias + 1

        Next ceros

dias = 0

        For Each ceros In Range("B19:DQ19")

        ' Debug.Print "Valor pick ups " & ceros
        ' Debug.Print "Valor control " & Sheets("Colores Condicionales").Cells(2 + dias, 6).Value
        ' Debug.Print "Nº dia " & dias
                       
        If Sheets("Colores Condicionales").Cells(6, 2 + dias) = 2 Or Sheets("Colores Condicionales").Cells(6, 2 + dias) = 3 Then
        
        ceros.Font.Bold = True
        
        End If
        
        dias = dias + 1

        Next ceros


Sheets("Colores Condicionales").Delete

End If


Application.DisplayAlerts = True
Application.ScreenUpdating = True
    

End Sub
