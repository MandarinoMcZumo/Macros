Sub buscar_aplicar_familias()



Dim grupo As Range, parametro As Range, grupo_oup As Range
Dim stock As Integer, n_familia As Integer
Dim office_name As String, grp_1 As String
Dim oup_master As Integer, oup_1 As String
Dim wb As String, ws As String


wb = ActiveWorkbook.Name
ws = ActiveSheet.Name
office_name = ActiveSheet.Name

Debug.Print "Nombre del libro activo: " & wb
Debug.Print "Nombre de la hoja activa: " & ws
Debug.Print "Nombre de la oficina: " & office_name



'Si la celda coincide para uno de los valores correspondientes a un grupo entonces:

For Each grupo In Workbooks(wb).Sheets(ws).Range("B1:B300")

    If grupo = "AA" Or grupo = "BB" Or grupo = "CC" Or grupo = "D" Or grupo = "N" Or grupo = "R" Or grupo = "T" Or grupo = "V" Or grupo = "C1" Or grupo = "VV" Or grupo = "E" Or grupo = "DD" Or grupo = "F" Or grupo = "FF" Or grupo = "S" Or grupo = "L" Or grupo = "LK" Or grupo = "RK" Or grupo = "P" Or grupo = "PP" Or grupo = "J" Or grupo = "JJ" Or grupo = "K" Or grupo = "I" Or grupo = "G" Or grupo = "4A" Then
    
    
'imprimo el grupo que vamos a tratar
    Debug.Print " "
    Debug.Print "Grupo ofertado: " & grupo.Value
    
    
'Te vas al SARG2 y lo activas
    Workbooks("SARG2.xlsm").Activate
    
'Buscas la hoja que coincide con el nombre de la oficina
    Sheets(office_name).Activate
        
         
'Comienzas un bucle que va a pasar por todas las celdas de la columna F en el SARG2
         For Each parametro In Workbooks("SARG2.xlsm").ActiveSheet.Range("f2", Range("f2").End(xlDown))

'Si el par치metro coincide con el grupo del CDV, entonces:
            If parametro = grupo Then
                
'Busca la hoja con el orden upgrade, y la activa
                Sheets("OUP").Activate

'Aplica un bucle para buscar la prioridad de upgrade para el grupo ofrecido y la guarda en oup_master
                For Each grupo_oup In Range("A2", Range("A2").End(xlDown))
                    
                        If grupo_oup = grupo Then
                        
                            oup_master = grupo_oup.Offset(0, 1)
                        
                        End If
                
               Next grupo_oup

'Ahora vuelve a la hoja de par치metros del SARG2 para la oficina, y busca los grupos cubiertos
            Sheets(ws).Activate
            
            grp_1 = parametro.Offset(0, 1)
            
'Ahora busca la prioridad de upgrade para ese grupo y la almacena en oup_1
            Sheets("OUP").Activate
            
            For Each grupo_oup In Range("A2", Range("A2").End(xlDown))
                    
                        If grupo_oup = grp_1 Then
                        
                            oup_1 = grupo_oup.Offset(0, 1)
                            
                        End If
                
            Next grupo_oup
            
'Ahora vuelve a la hoja de par치metros del SARG2 para la oficina, para buscar el stock de seguridad para la familia, y almacenarlo en stock
                Sheets(ws).Activate

                grp_n_familia = parametro.Offset(0, 1).Value
                stock = parametro.Offset(0, 2).Value
                
                    
 'Imprimimos los resultados para ver que efectivamente se han recogido de forma adecuada
                    Debug.Print "Grupo cubierto: " & grp_n_familia
                    Debug.Print "Stock de seguridad: " & stock
                    Debug.Print "Prioridad Orden Upgrade grupo ofertado: " & oup_master
                    Debug.Print "Prioridad Orden Upgrade grupo cubierto: " & oup_1
                
               
'Termina el bucle para almacenar par치metros
            End If


        Next parametro
    

    End If

etiqueta:


'Comienza a buscar el siguiente grupo
Next grupo



Workbooks(wb).Activate

End Sub
